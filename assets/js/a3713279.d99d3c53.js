(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[720],{7376:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return l},metadata:function(){return o},toc:function(){return p},default:function(){return m}});var n=a(2122),r=a(9756),i=(a(7294),a(3905)),l={sidebar_position:6,id:"deploy",title:"Deployment",sidebar_label:"Production deployment"},o={unversionedId:"deploy",id:"deploy",isDocsHomePage:!1,title:"Deployment",description:"Updating dependencies",source:"@site/docs/deployment.md",sourceDirName:".",slug:"/deploy",permalink:"/stencil/docs/deploy",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/deployment.md",version:"current",sidebar_label:"Production deployment",sidebarPosition:6,frontMatter:{sidebar_position:6,id:"deploy",title:"Deployment",sidebar_label:"Production deployment"},sidebar:"tutorialSidebar",previous:{title:"Configure layouts",permalink:"/stencil/docs/layout"},next:{title:"Building a Docker image",permalink:"/stencil/docs/docker"}},p=[{value:"Updating dependencies",id:"updating-dependencies",children:[]},{value:"Deploying the application",id:"deploying-the-application",children:[]},{value:"Configuring the backend",id:"configuring-the-backend",children:[]},{value:"Configuring the frontend",id:"configuring-the-frontend",children:[]},{value:"Configuring STENCIL Config.js",id:"configuring-stencil-configjs",children:[]},{value:"Deploying the application",id:"deploying-the-application-1",children:[]},{value:"Learn More",id:"learn-more",children:[]}],d={toc:p};function m(e){var t=e.components,a=(0,r.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"updating-dependencies"},"Updating dependencies"),(0,i.kt)("hr",null),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Before deployment to a production environment, all STENCIL dependencies should be updated to reduce risk of using compromised repositories"),(0,i.kt)("li",{parentName:"ul"},"To get a list of packages that are outdated, execute the below command from the project root directory",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"npm outdated")))),(0,i.kt)("li",{parentName:"ul"},"From your project root directory, run the update command",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"npm update"))))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Updating dependencies sometimes breaks the app, which is expected and common software development. Refer the changelog for the packages that are updated to fix any issues.")),(0,i.kt)("p",null,"More details on above command usage : ",(0,i.kt)("a",{parentName:"p",href:"https://docs.npmjs.com/updating-packages-downloaded-from-the-registry"},"npm docs")),(0,i.kt)("h2",{id:"deploying-the-application"},"Deploying the application"),(0,i.kt)("hr",null),(0,i.kt)("p",null,"This project was bootstrapped with ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/facebook/create-react-app"},"Create React App"),". You can use the default ",(0,i.kt)("inlineCode",{parentName:"p"},"build")," scripts to compile the project."),(0,i.kt)("p",null,"To ",(0,i.kt)("inlineCode",{parentName:"p"},"build")," the project, use ",(0,i.kt)("inlineCode",{parentName:"p"},"npm run build")," from your project's root folder. This will generate a ",(0,i.kt)("strong",{parentName:"p"},"build")," directory with minified code. For detailed instructions on how to use this ",(0,i.kt)("strong",{parentName:"p"},"build")," directory with nginx or its alternatives follow the official ",(0,i.kt)("inlineCode",{parentName:"p"},"deployment")," instructions under ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Learn More"))," section below."),(0,i.kt)("h2",{id:"configuring-the-backend"},"Configuring the backend"),(0,i.kt)("hr",null),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create a ",(0,i.kt)("inlineCode",{parentName:"li"},".env")," file or edit the existing."),(0,i.kt)("li",{parentName:"ul"},"Add settings to your ",(0,i.kt)("inlineCode",{parentName:"li"},".env")," file as described in the table below.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Config details")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Setting"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DB_HOST")),(0,i.kt)("td",{parentName:"tr",align:null},"Use ",(0,i.kt)("inlineCode",{parentName:"td"},"localhost")," to connect to a local installation of mongodb (default), please set it to ",(0,i.kt)("inlineCode",{parentName:"td"},"mongo:27017")," while creating a docker image.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DB_NAME")),(0,i.kt)("td",{parentName:"tr",align:null},"Name of the database to store app data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"API_PORT")),(0,i.kt)("td",{parentName:"tr",align:null},"API port name data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"FRONT_API")),(0,i.kt)("td",{parentName:"tr",align:null},"root URL of the frontend data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"HTTPS")),(0,i.kt)("td",{parentName:"tr",align:null},"Boolean determining if STENCIL uses HTTPS data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"HTTPSCERT")),(0,i.kt)("td",{parentName:"tr",align:null},"Path of https certificate  data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"HTTPSKEY")),(0,i.kt)("td",{parentName:"tr",align:null},"Path of https key data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SESSION_ENCRYPTION")),(0,i.kt)("td",{parentName:"tr",align:null},"Name of session encryption data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SESSION_NAME")),(0,i.kt)("td",{parentName:"tr",align:null},"Name of session data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"MASTER_PWD")),(0,i.kt)("td",{parentName:"tr",align:null},"Master login password data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SVC_STENCIL_PWD")),(0,i.kt)("td",{parentName:"tr",align:null},"Password to enable STENCIL POST from token data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"PROXY_SETTING")),(0,i.kt)("td",{parentName:"tr",align:null},"Proxy address data.")))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"default ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," configuration for local development")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'DB_HOST="localhost"\nDB_NAME="testDB"\nAPI_PORT=8081\nFRONT_API="https://localhost:3000"\nHTTPS=true\nHTTPSCERT = "/home/xxx/fullchain.pem"   \nHTTPSKEY = "/home/xxx/privkey.pem"\nSESSION_ENCRYPTION = "xxxxxx"\nSESSION_NAME = "stencil"\nMASTER_PWD = "aaaaaa"\nSVC_STENCIL_PWD = "bbbbbb"\nPROXY_SETTING=\'{"/xxx" : "http://xxx.xxxx.xxxx.xx:xxxx"}\'\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},'If your frontend app needs to access api call from 3rd party, e.g. galaxy server, you need to use proxy through backend server. In the frontend app, the URL "',(0,i.kt)("a",{parentName:"li",href:"http://xxx.xxxx.xxxx.xx:xxxx/datasets/%7Boptions%7D%22"},'http://xxx.xxxx.xxxx.xx:xxxx/datasets/{options}"'),' should be replaced with "http://backendserver:xxxx/datasets/{options}". Most browsers would prohibit cross-domain call for the front end, so that proxy is needed.')),(0,i.kt)("h2",{id:"configuring-the-frontend"},"Configuring the frontend"),(0,i.kt)("hr",null),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create a ",(0,i.kt)("inlineCode",{parentName:"li"},".env")," file or edit the existing."),(0,i.kt)("li",{parentName:"ul"},"Add settings to your ",(0,i.kt)("inlineCode",{parentName:"li"},".env")," file as described in the table below.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Config details")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Setting"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"PORT")),(0,i.kt)("td",{parentName:"tr",align:null},"Frontend PORT number")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"HTTPS")),(0,i.kt)("td",{parentName:"tr",align:null},"Boolean determining if STENCIL uses HTTPS")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SSL_CRT_FILE")),(0,i.kt)("td",{parentName:"tr",align:null},"path of https certificate  data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SSL_KEY_FILE")),(0,i.kt)("td",{parentName:"tr",align:null},"path of https key data.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"BROWSER")),(0,i.kt)("td",{parentName:"tr",align:null},"Browser support data.")))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"default ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," configuration for local development")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'PORT="3000"\nHTTPS=true\nSSL_CRT_FILE=/home/xxx/fullchain.pem\nSSL_KEY_FILE=/home/xxx/privkey.pem\nBROWSER=none\n')),(0,i.kt)("h2",{id:"configuring-stencil-configjs"},"Configuring STENCIL Config.js"),(0,i.kt)("hr",null),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Modify ",(0,i.kt)("em",{parentName:"li"},"stencil/frontend/src/Config.js"))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Config details")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Setting"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"apiURL")),(0,i.kt)("td",{parentName:"tr",align:null},"URL of the backend server")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SSOURL")),(0,i.kt)("td",{parentName:"tr",align:null},"URL of login page")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"librariesEndPoint")),(0,i.kt)("td",{parentName:"tr",align:null},"API endpoint for retrieve library list")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"libraryPageEndPoint")),(0,i.kt)("td",{parentName:"tr",align:null},"API endpoint for retrieve a library based on db id")))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Sample Config.js")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'apiURL: "http://stencil.biohpc.cornell.edu:8081",\nSSOURL: "https://stencil.biohpc.cornell.edu",\nlibrariesEndPoint: "/libraries",\nlibraryPageEndPoint: "/libraries/dbid"\n')),(0,i.kt)("h2",{id:"deploying-the-application-1"},"Deploying the application"),(0,i.kt)("hr",null),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Below instructions have been tested for a server running ",(0,i.kt)("inlineCode",{parentName:"p"},"CentOS"),". However, all the app related configuration and deployment is still valid for any linux distribution. Install relevant dependencies based on respective distros.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Install dependencies on the Server")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Install ",(0,i.kt)("a",{parentName:"li",href:"https://nodejs.org/en/"},(0,i.kt)("inlineCode",{parentName:"a"},"node"))," (stable version) for ",(0,i.kt)("inlineCode",{parentName:"li"},"CentOS"),", here is a ",(0,i.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-a-centos-7-server"},"tutorial"),"."),(0,i.kt)("li",{parentName:"ul"},"Install ",(0,i.kt)("a",{parentName:"li",href:"https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/"},(0,i.kt)("inlineCode",{parentName:"a"},"mongodb"))," on the ",(0,i.kt)("inlineCode",{parentName:"li"},"CentOS")," server."),(0,i.kt)("li",{parentName:"ul"},"Install ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/pm2"},(0,i.kt)("inlineCode",{parentName:"a"},"pm2"))," a production process manager for Node.js applications with a built-in load balancer."),(0,i.kt)("li",{parentName:"ul"},"Once you have configured the backend, below command will create a daemon and keeps the app running & restarts on internal app crashes, ",(0,i.kt)("a",{parentName:"li",href:"https://pm2.io/doc/en/runtime/overview/?utm_source=pm2&utm_medium=website&utm_campaign=rebranding"},"read more here"),".")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\x3c!-- go into the project folder --\x3e\ncd <project_directory>\n\n\x3c!-- start the server using pm2 --\x3e\npm2 start server.js --name APIServer\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You need to update the ",(0,i.kt)("inlineCode",{parentName:"li"},"options")," property in the above code with server specific certificate files, after requesting them from a certificate authority."),(0,i.kt)("li",{parentName:"ul"},"Restart the app to apply changes."),(0,i.kt)("li",{parentName:"ul"},"Read more about using certificates at ",(0,i.kt)("a",{parentName:"li",href:"https://nodejs.org/api/https.html#https_https_createserver_options_requestlistener"},"Node HTTPS docs"))),(0,i.kt)("h2",{id:"learn-more"},"Learn More"),(0,i.kt)("hr",null),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Getting started with ",(0,i.kt)("a",{parentName:"li",href:"https://facebook.github.io/create-react-app/docs/getting-started"},"Create React App documentation"),"."),(0,i.kt)("li",{parentName:"ul"},"To learn React, check out the ",(0,i.kt)("a",{parentName:"li",href:"https://reactjs.org/"},"React documentation"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://facebook.github.io/create-react-app/docs/code-splitting"},(0,i.kt)("strong",{parentName:"a"},"Code Splitting"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://facebook.github.io/create-react-app/docs/analyzing-the-bundle-size"},(0,i.kt)("strong",{parentName:"a"},"Analyzing the Bundle Size"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://facebook.github.io/create-react-app/docs/making-a-progressive-web-app"},(0,i.kt)("strong",{parentName:"a"},"Making a Progressive Web App"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://facebook.github.io/create-react-app/docs/advanced-configuration"},(0,i.kt)("strong",{parentName:"a"},"Advanced Configuration"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://facebook.github.io/create-react-app/docs/deployment"},(0,i.kt)("strong",{parentName:"a"},"Deployment"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://facebook.github.io/create-react-app/docs/troubleshooting#npm-run-build-fails-to-minify"},(0,i.kt)("strong",{parentName:"a"},(0,i.kt)("inlineCode",{parentName:"strong"},"build")," fails to minify")))))}m.isMDXComponent=!0}}]);